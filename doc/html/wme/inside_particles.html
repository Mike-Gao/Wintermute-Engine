<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
<title>Particle effects</title>
<link rel="stylesheet" type="text/css" href="../styles.css">
</head>

<body>

<h2>Particle effects</h2>

<p>WME provides generic particle generators for creating real-time particle 
effects, such as snow, rain or smoke. For creating particle effects, WME 
provides so-called &quot;particle emitters&quot;. By setting a number of various 
parameters of the emitters, you can achieve many very different effects.</p>

<h3>WME particles demo</h3>

<p>Since the number of parameters the particle emitters are providing can be 
quite overwhelming at first, there is a demo project prepared for you. This demo 
project contains several predefined particle effects (snow, rain, smoke...) 
ready to be copied&amp;pasted to your own game. You can use those effects as a 
starting point for your own particle generators.</p>

<p>You will find the demo project in your WME DevKit installation folder, in the 
&quot;<i>projects\wme_particles</i>&quot; subfolder.</p>

<hr>

<h3>Creating particle emitters</h3>

<p>In WME, every particle emitter is attached to a game object, either an
<a href="inside_entites.html">entity</a> or an <a href="inside_actors.html">
actor</a>. This allows you to precisely specify the depth-position of the 
particles within a scene. Entities and actors provide a <b>
<a href="generated/scripting_ref_entity.html#CreateParticleEmitter">
CreateParticleEmitter()</a></b> method. This method initializes a particle 
emitter attached to a given entity/actor. Once initialized, you can query the 
particle emitter object using the <b>ParticleEmitter</b> property.</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>// get the scene entity we will use to attach the emitter to
var SomeEntity = Scene.GetNode("some_entity");

// initialize entity's particle emitter
SomeEntity.CreateParticleEmitter();

// query the emitter object
var Emit = SomeEntity.ParticleEmitter;
</pre>
    </td>
  </tr>
</table>

<p>The example above initializes and queries the particle emitter. Once queried, 
you can use the emitter object just like any other game object. You can call its 
methods and set its properties. For a complete list of available methods and 
properties see the <a href="generated/scripting_ref_particle.html">particle 
emitter scripting reference</a>.</p>

<h3>Destroying particle emitters</h3>

<p>If the particle emitter is no longer needed, you call the <b>
<a href="generated/scripting_ref_entity.html#DeleteParticleEmitter">
DeleteParticleEmitter()</a> </b>of an actor or an entity which owns the emitter to 
destroy it.</p>

<h3>Particle emitter parameters</h3>

<p>The particle emitter object provides numerous parameters. These parameters 
affect the initial state of the particles being generated by the emitter. Once 
the particle is &quot;shot&quot; out of the emitter, it lives its own life. Typically it 
moves across the screen in a certain direction with a certain velocity. For example, a 
snow emitter will generate snowflakes, and the snowflakes will slowly fall from 
the top to the bottom of the screen.</p>

<h4>Emitter shape and position</h4>

<p>First, we need to specify the shape of the emitter. Emitters in WME are 
always rectangles positioned somewhere on screen. You specify the position of 
the emitter rectangle and its width and height:</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.X = 100;
Emit.Y = 100;
Emit.Width = 200;
Emit.Height = 200;
</pre>
    </td>
  </tr>
</table>

<p>Note that by specifying zero as the emitter width or height you reduce the 
rectangle to a line. For example, a snow emitter will be shaped as a horizontal 
line positioned at the top edge of the screen.</p>

<p>If you set both width and height to zero, you will reduce the emitter to a 
point. For example a smoke emitter will emit all particles from a single point.</p>

<h4>Borders</h4>

<p>Sometimes you need to limit the area the particles can live in. For example, 
you want the snowflakes to disappear when they hit the ground. WME allows you to 
specify the area by setting particle borders. The borders once again shape a 
rectangular area on screen. Use the <b>
<a href="generated/scripting_ref_particle.html#SetBorder">SetBorder()</a></b> 
method to define the border rectangle's position and dimensions. Typically this 
border rectangle covers the entire scene area.</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.SetBorder(0, 0, Scene.Width, Scene.Height);
</pre>
    </td>
  </tr>
</table>

<p>Sometimes it's useful to set the thickness of the border. For example, you 
want the ground to have some height. You can set the thickness of the border 
edges using the <b>
<a href="generated/scripting_ref_particle.html#SetBorderThickness">
SetBorderThickness()</a></b> method. For example, to set the ground edge's 
height to 100 pixels, you'd call:</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.SetBorderThickness(0, 0, 0, 100);
</pre>
    </td>
  </tr>
</table>

<h4>Particles appearance</h4>
<p>The particles are represented by WME sprites. You can assign one or more 
sprites to the particle emitter using the <b>
<a href="generated/scripting_ref_particle.html#AddSprite">AddSprite()</a></b> 
method. When the emitter creates a new particle, it assigns it one of the 
defined sprites by random. There must be always at least one sprite assigned. To 
remove sprites from the list, use the <b>
<a href="generated/scripting_ref_particle.html#RemoveSprite">RemoveSprite()</a></b> 
method.</p>
<h4>Particles scale, velocity and direction</h4>
<p>When a new particle is generated by the emitter, it's assigned an initial 
direction, velocity and scale. These parameters are assigned by random from a 
specified range. You specify the range by setting emitter's properties.</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.Velocity1 = 20;
Emit.Velocity2 = 50;

Emit.Scale1 = 10;
Emit.Scale2 = 100;

Emit.Angle1 = 175;
Emit.Angle2 = 185;
</pre>
    </td>
  </tr>
</table>

<p>For example, if you set the above parameters to the emitter, whenever it 
generates a new particle it's assigned a random velocity from the range 20 to 
50, scale from 10 to 100 (percent) and direction angle from 175 to 185 
(degrees). The direction angle is specified as follows: 0 degrees - up, 90 
degrees - right, 180 degrees - down, 270 degrees - left. And of course any angle 
in between.</p>
<h4>Particles lifetime and transparency</h4>
<p>Similarly to the other random parameters, you can specify the lifetime of the 
particles. The lifetime specifies for how long the particle exists on screen 
until it &quot;dies&quot; and disappears. If you specify lifetime lesser or equal to zero, 
the particle's lifetime isn't limited. The particle only dies when it hits the 
border.</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.LifeTime1 = 4000;
Emit.LifeTime2 = 5000;
</pre>
    </td>
  </tr>
</table>

<p>In the above example, each new particle is given a random lifetime ranging 
from 4 to 5 seconds (the value is specified in milliseconds).</p>
<p>You can specify that the particle transparency should change in the course of 
particle's lifetime. For example, smoke particles will slowly fade out as they 
move away from the emitter. Once again, you specify the range of transparency 
values like this:</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.Alpha1 = 255; 
Emit.Alpha2 = 0;
Emit.AlphaTimeBased = true;
</pre>
    </td>
  </tr>
</table>

<p>If you use these settings, the particles will smoothly change their 
transparency from 255 (completely opaque) to 0 (completely transparent).</p>

<p>If you don't set the <b>AlphaTimeBased</b> attribute to true, the particles 
will use a randomly selected alpha transparency from the Alpha1 - Alpha2 range 
instead.</p>
<h4>Particles depth</h4>
<p>Each particle is assigned a random depth value. The depth can be used to fake 
a perspective when displaying the particles. For example, you want the 
snowflakes the smaller and slower the farther from the viewer they are. WME 
allows you to bind particle's scale, velocity and lifetime using the following 
attributes:</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.LifeTimeZBased = true;
Emit.VelocityZBased = true;
Emit.ScaleZBased = true;</pre>
    </td>
  </tr>
</table>

<h4>Particles rotation</h4>

<p>You can specify an initial particle rotation in degrees, as well as angular 
velocity to animate particles rotation. Once again, the actual rotation and 
angular velocity value is picked randomly from the given range.</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.Rotation1 = 0;
Emit.Rotation2 = 360;
Emit.AngVelocity1 = 1000;
Emit.AngVelocity2 = 2000;</pre>
    </td>
  </tr>
</table>


<h4>Particles growth/shrinking</h4>


<p>Particles can grow or shrink in course of their lifetime. Additionally you 
can specify whether the growth/shrinking is linear or exponential. Exponential 
growth means the particles grow the faster the bigger they are:</p>


<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.GrowthRate1 = 20;
Emit.GrowthRate2 = 50;
Emit.ExponentialGrowth = true;
</pre>
    </td>
  </tr>
</table>


<h4>Particles generation</h4>
<p>Particles are generated in batches. You can specify the time interval and 
size of the batches using the following attributes:</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.GenerationInterval = 200;
Emit.GenerationAmount = 40;
</pre>
    </td>
  </tr>
</table>

<p>These parameters specify that the emitter will generate 40 new particles 
every 200 milliseconds. The emitter will recycle dead particles and it will 
generate new ones when there are no free particles available. You can limit the 
maximum number of particles on screen by setting the <b>MaxParticles</b> 
property:</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.MaxParticles = 300;
</pre>
    </td>
  </tr>
</table>

<p>You should <b>always</b> set the maximum number of particles to some 
reasonable amount. Remember that large number of particles on screen can 
negatively affect the overall game performance!</p>
<p>You can query the current number of active particles using the <b>
NumLiveParticles</b> property.</p>
<h4>Fade in, fade out</h4>
<p>You can order the particles to smoothly fade in when they are created or to 
fade out when they are disappearing. For example, you would use the fade-out 
effect to simulate the snowflakes melting away when they land on the ground.</p>
<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.FadeOutTime = 1000;
</pre>
    </td>
  </tr>
</table>

<h4>Masking particles by a region</h4>

<p>Sometimes it's useful to display particles only if they are inside a specific 
screen region. You can achieve this by setting the <b>UseRegion</b> attribute to
<b>true</b>. This attribute has effect only if the particle emitter is owned by 
a region entity. In that case, the entity's region is used for controlling 
whether the particles are visible or not.</p>

<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.UseRegion = true;
</pre>
    </td>
  </tr>
</table>


<h4>Attaching script code to the particle emitter</h4>


<p>It can be useful to be able to run a piece of code whenever the particle 
emitter emits a new batch of particles (typically this can be used to attach 
some sound effect to particle bursts). For this purpose the emitter provides a 
property called <b>EmitEvent</b>. If you set this property, whenever the emitter 
emits new particles, it triggers an event with that name in its owner object. 
Set this property to <b>null</b> to disable event trigerring.</p>

<table>
  <tr>
    <td bgColor="#ccffff" style="font-size: 68%">
    <pre>Emit.EmitEvent = &quot;burst&quot;;

...

on "burst"
{
  this.PlaySound("sounds\burst.ogg");
}
</pre>
    </td>
  </tr>
</table>




<h3>Controlling the emitter</h3>
<p>Once the parameters are set, we execute the particles generation by calling 
the <b><a href="generated/scripting_ref_particle.html#Start">Start()</a></b> 
method of the emitter. This method accepts one optional parameter, which 
specifies the &quot;initial time&quot;. This time is used to populate&nbsp; the particle 
emitter with particles before it's first displayed on screen. For example, you 
don't want the snowflakes to start falling only after you enter the scene, it 
wouldn't look good. So you specify the initial time when calling the <b>Start()</b> 
method, and the emitter will simulate the particle generation and position the 
particles appropriately.</p>
<p>You can farther control the emitter's behavior using the self-describing 
methods <b><a href="generated/scripting_ref_particle.html#Stop">Stop()</a></b>,
<b><a href="generated/scripting_ref_particle.html#Pause">Pause()</a></b> and <b>
<a href="generated/scripting_ref_particle.html#Resume">Resume()</a></b>.</p>
<h3>Forces</h3>
<p>In addition to the particles' own velocity and direction, you can also affect 
their movement by placing additional &quot;forces&quot; to the scene. For example, you can 
simulate wind blowing using a force. There are two types of force: global force 
and point force. Global forces affect all the particles the same way, while 
point forces affect the particle the more the closer the particle is to the 
force origin. You define each force by its name, direction, strength and 
position in case of point forces. To add a new force or to replace force with 
the same name, use either the <b>
<a href="generated/scripting_ref_particle.html#AddGlobalForce">AddGlobalForce()</a></b> 
or <b><a href="generated/scripting_ref_particle.html#AddPointForce">
AddPointForce()</a></b> methods. To remove a force use the <b>
<a href="generated/scripting_ref_particle.html#RemoveForce">RemoveForce()</a>
</b>method.</p>
</body>

</html>